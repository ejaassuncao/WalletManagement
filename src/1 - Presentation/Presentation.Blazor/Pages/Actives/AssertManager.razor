@using System.Collections.Generic;
@using Domain.Core.Dto;
@using Domain.Models.Extension;
@using Presentation.Blazor.Component
@using System.Globalization
@using Presentation.Blazor.Configuration;
@inject HttpClient Http
@inject IStringLocalizer<Messages> Loc

@page "/assertmanager"
<PageTitle>@Title</PageTitle>

<div class="row">
    <div class="col-12">
        <div class="table-title">
            <div class="row">
                <div class="col-xs-6 col-sm-6">
                    <h2>@Title</h2>
                </div>
                <div class="col-xs-6 col-sm-6">
                    <a data-bs-toggle="modal" data-bs-target="#addActive" class="btn btn-success"><i class="fa fa-plus-circle" aria-hidden="true"></i><span>@Loc["New"]</span></a>
                    <a class="btn btn-primary" @onclick="Search"><i class="fa fa-search" aria-hidden="true"></i><span>@Loc["Search"]</span></a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <TableComponent HeaderColumns="Category, Sector, Ticker, Price, Amount, Cost, Total Price, Total Cost, L/P, - "
                        DataBind="actives"
                        Context="active"
                        Loading=@loading
                        MessageEmpty="@Messages.Not_found"
                        MessageLoading="@Messages.Loading">
            <RowTemplate>
                <td>@active.Category</td>
                <td>@active.Sector</td>
                <td>@active.Ticker</td>
                <td>@active.Price.ToCurrency()</td>
                <td>@active.Amount.ToQuantity()</td>
                <td>@active.UnitCost.ToCurrency()</td>
                <td>@active.TotalPrice.ToCurrency()</td>
                <td>@active.TotalCost.ToCurrency()</td>
                <td>@active.LP.ToCurrency()</td>
                <td>                   
                    <a href="#addActive?Edit" class="new" data-toggle="modal"><i class="fa-solid fa-plus"></i></a>
                </td>
            </RowTemplate>
        </TableComponent>
    </div>
</div>

<ModalComponent Id="addActive" Title="Insert Assets" >
    <BodyTemplate>
        <form class="row g-3">
            <div class="col-md-12">
                <label for="inputNameActive" class="form-label">Name Active</label>
                <input type="text" class="form-control" id="inputNameActive">
            </div>
            <div class="col-md-6">
                <label for="inputPassword4" class="form-label">Password</label>
                <input type="password" class="form-control" id="inputPassword4">
            </div>
            <div class="col-12">
                <label for="inputAddress" class="form-label">Address</label>
                <input type="text" class="form-control" id="inputAddress" placeholder="1234 Main St">
            </div>
            <div class="col-12">
                <label for="inputAddress2" class="form-label">Address 2</label>
                <input type="text" class="form-control" id="inputAddress2" placeholder="Apartment, studio, or floor">
            </div>
            <div class="col-md-6">
                <label for="inputCity" class="form-label">City</label>
                <input type="text" class="form-control" id="inputCity">
            </div>
            <div class="col-md-4">
                <label for="inputState" class="form-label">State</label>
                <select id="inputState" class="form-select">
                    <option selected>Choose...</option>
                    <option>...</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="inputZip" class="form-label">Zip</label>
                <input type="text" class="form-control" id="inputZip">
            </div>
            <div class="col-12">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="gridCheck">
                    <label class="form-check-label" for="gridCheck">
                        Check me out
                    </label>
                </div>
            </div>            
        </form>
    </BodyTemplate>
    <FooterTemplate>
        <div class="col-12">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" >Close</button>           
        </div>
    </FooterTemplate>
</ModalComponent>

@code {

    private List<PortifolioDto> actives = new List<PortifolioDto>();
    private const string Title = "Asset Management";
    private bool loading;


    public async Task Search()
    {
        loading = true;       
        actives = await Http.GetFromJsonAsync<List<PortifolioDto>>(HelperEndPoints.Api("Portifolios"));
        loading = false;
    }   
}
